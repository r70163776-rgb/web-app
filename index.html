--><!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniPlay — High CPM (Popunder + Interstitial + Push)</title>
  <meta name="description" content="High-CPM Telegram Web App optimized for Monetag — Popunder + Interstitial + In-Page Push" />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#071026;--card:#081028;--accent:#ff6b6b;--muted:#9aa4b2}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#eaf2ff;background:linear-gradient(180deg,#071026,#051025)}
    .wrap{max-width:980px;margin:16px auto;padding:16px}
    .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px}
    .play-area{height:360px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-direction:column}
    .score{font-size:48px;font-weight:700}
    .actions{display:flex;gap:8px;margin-top:12px}
    button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .primary{background:linear-gradient(90deg,var(--accent),#1fb6ff);color:white}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
      <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#ff6b6b,#1fb6ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700">MP</div>
      <div>
        <h1 style="margin:0;font-size:20px">MiniPlay — High CPM</h1>
        <p style="margin:6px 0;color:var(--muted)">Popunder + Interstitial + In-Page Push — Target: USA + Global</p>
      </div>
    </header><main style="display:grid;grid-template-columns:1fr 320px;gap:12px">
  <section class="card">
    <div class="play-area" id="playArea">
      <div class="score" id="score">0</div>
      <div style="color:var(--muted);margin-top:6px">Tap <strong>PLAY</strong> to start — first gesture will unlock ad triggers</div>
      <div class="actions">
        <button id="playBtn" class="primary">PLAY</button>
        <button id="interstitialBtn" class="ghost">Show Interstitial</button>
      </div>
    </div>
  </section>

  <aside class="card">
    <div style="display:flex;flex-direction:column;gap:10px">
      <div><strong>Session</strong><div id="sessionTime" style="color:var(--muted)">0s</div></div>
      <div><strong>Ad Status</strong><div id="adStatus" style="color:var(--muted)">Waiting for gesture</div></div>
      <div><strong>Manual Triggers</strong>
        <div style="margin-top:8px;display:flex;gap:8px"><button id="manualPop" class="primary">Trigger Popunder</button><button id="pushBtn" class="ghost">Trigger Push</button></div>
      </div>
    </div>
  </aside>
</main>

<footer>Deploy to Vercel • Add domain to Monetag dashboard • Test in incognito & real devices</footer>

  </div>  <script>
    // ================= CONFIG =================
    const CONFIG = {
      monetagPopunder: '// Rewarded Popup

show_10139509('pop').then(() => {
    // user watch ad till the end or close it in interstitial format
    // your code to reward user for rewarded format
}).catch(e => {
    // user get error during playing ad
    // do nothing or whatever you want
})',
      monetagInterstitial: '// Rewarded interstitial

show_10139509().then(() => {
    // You need to add your user reward function here, which will be executed after the user watches the ad.
    // For more details, please refer to the detailed instructions.
    alert('You have seen an ad!');
})',
      monetagPush: '// In-App Interstitial

show_10139509({
  type: 'inApp',
  inAppSettings: {
    frequency: 2,
    capping: 0.1,
    interval: 30,
    timeout: 5,
    everyPage: false
  }
})

/*
This value is decoded as follows:
- show automatically 2 ads
  within 0.1 hours (6 minutes)
  with a 30-second interval between them
  and a 5-second delay before the first one is shown.
  The last digit, 0, means that the session will be saved when you navigate between pages.
  If you set the last digit as 1, then at any transition between pages,
  the session will be reset, and the ads will start again.
*/',
      popunderDelayMs: 700,
      interstitialDelayMs: 1500,
      adRefreshSec: 60,
      targetCountries: ['US','CA','GB','AU']
    };

    // ================ STATE ==================
    let score = 0;
    let sessionSeconds = 0;
    let sessionTimer = null;
    let popunderFired = false;
    let interstitialFired = false;

    const scoreEl = document.getElementById('score');
    const playBtn = document.getElementById('playBtn');
    const interstitialBtn = document.getElementById('interstitialBtn');
    const manualPop = document.getElementById('manualPop');
    const pushBtn = document.getElementById('pushBtn');
    const sessionTimeEl = document.getElementById('sessionTime');
    const adStatusEl = document.getElementById('adStatus');

    // ================ SESSION HELPERS ==============
    function startSession(){
      if(sessionTimer) return;
      sessionTimer = setInterval(()=>{
        sessionSeconds++;
        sessionTimeEl.textContent = sessionSeconds + 's';
      },1000);
    }

    function stopSession(){ clearInterval(sessionTimer); sessionTimer = null; sessionSeconds = 0; sessionTimeEl.textContent = '0s'; }

    // ================ AD TRIGGERS ================
    function loadMonetagScript(url, attrs={}){
      if(!url || url.startsWith('REPLACE')) return console.log('Monetag script placeholder, replace before production');
      return new Promise((res,rej)=>{
        const s = document.createElement('script');
        s.async = true; s.setAttribute('data-cfasync','false');
        s.src = url;
        Object.keys(attrs).forEach(k=>s.setAttribute(k,attrs[k]));
        s.onload = ()=>res(); s.onerror = (e)=>rej(e);
        document.head.appendChild(s);
      });
    }

    function openPopunder(url){
      // open in new tab/window from user gesture
      try{
        if(!url || url.startsWith('REPLACE')){ console.log('// Rewarded Popup

show_10139509('pop').then(() => {
    // user watch ad till the end or close it in interstitial format
    // your code to reward user for rewarded format
}).catch(e => {
    // user get error during playing ad
    // do nothing or whatever you want
})'); return false; }
        const w = window.open(url + (url.includes('?') ? '&' : '?') + 'pd=1', '_blank');
        if(w){ w.blur(); window.focus(); adStatusEl.textContent = 'Popunder opened'; return true; }
        adStatusEl.textContent = 'Popunder blocked'; return false;
      }catch(e){ console.warn('Popunder error', e); adStatusEl.textContent = 'Popunder error'; return false; }
    }

    function showInterstitial(url){
      // Many monetag interstitials require a script/API — this is a fallback that opens a centered popup
      try{
        if(!url || url.startsWith('REPLACE')){ console.log('Interstitial placeholder'); return false; }
        const width = Math.min(900, Math.round(window.innerWidth * 0.9));
        const height = Math.min(700, Math.round(window.innerHeight * 0.9));
        const left = Math.round((screen.width - width) / 2);
        const top = Math.round((screen.height - height) / 2);
        const win = window.open(url, 'interstitial', `width=${width},height=${height},left=${left},top=${top}`);
        if(win){ win.focus(); adStatusEl.textContent = 'Interstitial shown'; return true; }
        adStatusEl.textContent = 'Interstitial blocked'; return false;
      }catch(e){ console.warn('Interstitial error', e); adStatusEl.textContent = 'Interstitial error'; return false; }
    }

    function triggerPush(url){
      // If Monetag exposes a push API, call it. Otherwise simulate by opening a small notice or endpoint.
      if(!url || url.startsWith('REPLACE')){ console.log('Push placeholder'); alert('Simulated push event (demo)'); return false; }
      // example: fetch push endpoint
      fetch(url).then(r=>{ adStatusEl.textContent = 'Push triggered'; }).catch(e=>{ adStatusEl.textContent = 'Push failed'; });
      return true;
    }

    // ================ USER GESTURE BINDINGS ================
    playBtn.addEventListener('click', async (e)=>{
      score += Math.floor(Math.random()*7)+3; scoreEl.textContent = score; startSession();

      // Fire popunder once on first user gesture
      if(!popunderFired){
        popunderFired = true;
        adStatusEl.textContent = 'Firing Popunder...';
        setTimeout(()=>{
          openPopunder(CONFIG.monetagPopunder);
        }, CONFIG.popunderDelayMs);
      }

      // Preload interstitial script if provided (non-blocking)
      if(CONFIG.monetagInterstitial && CONFIG.monetagInterstitial.indexOf('REPLACE')===-1){
        loadMonetagScript(CONFIG.monetagInterstitial).then(()=>console.log('Interstitial script loaded')).catch(()=>{});
      }
    });

    interstitialBtn.addEventListener('click', ()=>{
      if(interstitialFired){ adStatusEl.textContent = 'Interstitial already shown'; return; }
      interstitialFired = true;
      setTimeout(()=>{
        showInterstitial(CONFIG.monetagInterstitial);
      }, CONFIG.interstitialDelayMs);
    });

    manualPop.addEventListener('click', ()=>{ openPopunder(CONFIG.monetagPopunder); });
    pushBtn.addEventListener('click', ()=>{ triggerPush(CONFIG.monetagPush); });

    // ================ QUALITY & SAFEGUARDS ================
    // Minimal heuristics to avoid opening ads for clearly bot-like sessions
    let interacted = false; ['click','touchstart','mousemove','keydown'].forEach(evt=>{
      window.addEventListener(evt, ()=>{ interacted = true; }, {once:true});
    });

    setTimeout(()=>{
      if(!interacted) adStatusEl.textContent = 'No interaction detected — Ads disabled until user gesture.';
    },5000);

    // ================ OPTIONAL: Auto-insert Monetag global script if provided ================
    (function tryInsertGlobal(){
      // If Monetag provides a single global script that handles all ad formats, set it in monetagGlobal variable
      const monetagGlobal = CONFIG.monetagGlobal || null;
      if(monetagGlobal && !monetagGlobal.startsWith('REPLACE')) loadMonetagScript(monetagGlobal).catch(()=>{});
    })();

    // ================ CLEANUP ================
    window.addEventListener('beforeunload', ()=>{
      // Optionally notify server/Monetag about session end
    });

  </script></body>
</html>
